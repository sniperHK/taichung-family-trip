# 台中家庭旅行 2026 - 上下文共享

> 最後更新：2026-02-19 by Claude Code

## 基本規範

- **此專案使用 Git 版本控制**
- 所有變更應有適當的 commit

## 專案資訊

- **用途**：台中家庭旅行（2026/2/20-22）三天兩夜行程網頁
- **技術棧**：純 HTML/CSS/JS 單頁式網站，無框架
- **GitHub**：https://github.com/sniperHK/taichung-family-trip
- **Netlify**：https://taichung-family-trip.netlify.app
- **部署方式**：GitHub → Netlify 自動部署（push to main 觸發）
- **Publish directory**：`/`（根目錄）

## 主要內容

| 檔案 | 說明 |
|------|------|
| `index.html` | 旅遊網頁主體（海洋度假風、時間軸卡片、互動行李清單） |
| `行程.md` | 原始行程 Markdown 文件（**唯一資料來源**） |
| `交通路線.md` | 全程 12 條駕車路線詳細指南（車程、停車、替代路線） |
| `.gitignore` | 忽略明文 secrets 與本地設定，允許追蹤 `.env.age`、`.claude/setup.sh` |
| `.env.example` | 環境變數模板（GitHub / Netlify） |
| `.env.age` | age 加密後的環境變數（可提交） |
| `.claude/setup.sh` | Cloud VM 啟動時自動解密 `.env.age` |
| `secrets/env.keys` | 環境變數 allowlist |

## 連動規範（IMPORTANT）

`行程.md` 與 `index.html` 必須保持同步：

- **`行程.md` 是唯一資料來源 (Single Source of Truth)**
- 任何行程變更（時間、景點、注意事項、行李清單等）都應先更新 `行程.md`
- 更新 `行程.md` 後，**必須同步更新 `index.html`** 中對應的內容
- GitHub ↔ Netlify 已設定 CI/CD：push to `main` 自動觸發 Netlify 重新部署
- 因此：更新 `行程.md` → 同步 `index.html` → commit + push → Netlify 自動上線

## age 加密（Cloud VM Secrets）

本專案已初始化 age keypair secrets 管理，供 Cloud VM / Remote Agent 使用：

- **Public key**：`age1sd7r54gpapjuvt67x4g4ednmzus7s5xqx93ltcv57axcrs6w7yyqktrceh`
- **Private key**：`age-key.txt`（git ignored）
- **Encrypted env**：`.env.age`（git tracked）
- **Auto decrypt script**：`.claude/setup.sh`

目前 `.env` 已填入：
- GitHub：`GITHUB_TOKEN`、`GITHUB_REPOSITORY`、`GITHUB_OWNER`
- Netlify：`NETLIFY_SITE_ID`、`NETLIFY_SITE_NAME`、`NETLIFY_SITE_URL`、`NETLIFY_BUILD_HOOK_URL`

目前尚缺：
- `NETLIFY_AUTH_TOKEN`（記錄於 `.env.missing`）

備援部署：
- 可使用 `NETLIFY_BUILD_HOOK_URL` 在沒有 PAT 的情況下觸發 Netlify build/deploy。

Cloud VM 需設定：
- `AGE_SECRET_KEY=<age-key.txt 中 AGE-SECRET-KEY-1... 那行>`

## Git 歷史

```
* a0f06ac feat: Day3 新增全安堂太陽餅 DIY + 交通路線研究
* ec3decd chore: add netlify build hook fallback for remote deploy
* 5bb9946 feat: initialize age-encrypted env for remote VM
* 067f75f fix: 同步行程.md 變更至 index.html
* 0b47b27 docs: update .shared-ai-context.md with deployment info
* a540b3b chore: add .netlify to .gitignore
* 8f2d959 feat: 台中家庭旅行網頁
```

## 更新規則

### Git 歷史（機械同步）
- 每次完成工作後執行 `git log --oneline --graph -15` 並原樣更新。

### 變更日誌（語義紀錄）
- 記錄所有 AI 操作（包含未 commit 的檔案變更、設定變更與關鍵決策）。

## 變更日誌

- [2026-02-19] [Codex]: 初始化 `.shared-ai-context.md`，補上 Git 歷史與專案資訊；建立 `.shared-ai-context` 相容連結。
- [2026-02-19] [Claude Code]: 建立海洋度假風旅遊網頁 (index.html)，含三天行程時間軸、住宿資訊、景點詳情（可展開）、實用資訊、互動行李清單（localStorage 持久化）。部署至 GitHub (sniperHK/taichung-family-trip) 與 Netlify (taichung-family-trip.netlify.app)，設定 GitHub → Netlify CI/CD 自動部署。更新 .shared-ai-context.md。
- [2026-02-19] [Claude Code]: 同步行程.md 變更至 index.html（高美濕地注意事項更新、海洋館時間修正 09:30 開館、Day3 行程重排含 09:30 check-out、天氣預報加入親子提醒、衣物清單合併為薄外套+防風層）。新增連動規範至 .shared-ai-context.md。
- [2026-02-19] [Codex]: 依全域指引完成 age-init：新增 `.env.example`、`secrets/env.keys`、`.env.age`、`.claude/setup.sh`，並更新 `.gitignore` 支援加密 secrets 流程。自動填入 GitHub/Netlify 可取得欄位；`NETLIFY_AUTH_TOKEN` 尚待補值（`.env.missing`）。
- [2026-02-19] [Codex]: 新增 Netlify Build Hook 備援（`NETLIFY_BUILD_HOOK_URL`）並重新加密 `.env.age`，讓遠端 VM 在無 PAT 時仍可觸發部署。
- [2026-02-19] [Claude Code]: 研究交通路線（12 條）並建立 交通路線.md；研究沿途特色公園與文化體驗。Day3 新增全安堂太陽餅博物館 DIY（13:00），同步更新 index.html。
